module.exports=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t){e.exports=require("request-promise")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,c){function i(e){try{u(o.next(e))}catch(e){c(e)}}function s(e){try{u(o.throw(e))}catch(e){c(e)}}function u(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),c=n(0);t.TokenManager=class{constructor(e){this.config=e,this.currentRefreshToken=this.config.refreshToken,this.accessToken$=this.refreshAccess(),this.accessToken$.catch(console.error),setInterval(()=>{this.accessToken$=this.refreshAccess(),this.accessToken$.catch(console.error)},216e5)}refreshAccess(){return o(this,void 0,void 0,function*(){const e=yield c.post("https://api.monzo.com/oauth2/token",{form:{grant_type:"refresh_token",client_id:this.config.clientId,client_secret:this.config.clientSecret,refresh_token:this.currentRefreshToken},json:!0});return this.writeNewRefreshToken(this.currentRefreshToken,e.refresh_token),this.currentRefreshToken=e.refresh_token,e.access_token})}writeNewRefreshToken(e,t){if(!e)throw Error("No Refresh Token");const n=r.readFileSync("./config/config.js","utf-8").replace(e,t);r.writeFileSync("./config/config.js",n,"utf-8"),console.log("Written new refresh token")}get AccessToken$(){return this.accessToken$}}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,c){function i(e){try{u(o.next(e))}catch(e){c(e)}}function s(e){try{u(o.throw(e))}catch(e){c(e)}}function u(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.MonzoFetcher=class{constructor(e){this.accountId=e}fetch(e){return o(this,void 0,void 0,function*(){const t=this.fetchTransactions(this.accountId,e),n=this.fetchBalance(this.accountId,e),[o,r]=yield Promise.all([t,n]);return[o,r]})}fetchTransactions(e,t){return o(this,void 0,void 0,function*(){const n=yield r.get(`https://api.monzo.com/transactions?account_id=${e}`,{headers:{Authorization:`Bearer ${t}`},json:!0});return n.transactions.slice(Math.max(n.transactions.length-10,0)).reverse()})}fetchBalance(e,t){return o(this,void 0,void 0,function*(){return yield r.get(`https://api.monzo.com/balance?account_id=${e}`,{headers:{Authorization:`Bearer ${t}`},json:!0})})}}},function(e,t){e.exports=require("node_helper")},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,c){function i(e){try{u(o.next(e))}catch(e){c(e)}}function s(e){try{u(o.throw(e))}catch(e){c(e)}}function u(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(i,s)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(4),c=n(3),i=n(2);let s,u;e.exports=r.create({start(){},socketNotificationReceived(e,t){return o(this,void 0,void 0,function*(){switch(e){case"config":const n=t;s=new i.TokenManager(n),u=new c.MonzoFetcher(n.accountId);const o=yield s.AccessToken$,r=yield u.fetch(o);console.log(r)}})}})}]);