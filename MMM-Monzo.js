!function(t){var e={};function n(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){"use strict";function o(t,e,n){const o=t/e*n.width;return Math.floor(o)}function a(t,e,n,o){const a=(t-n)/Math.abs(n-o)*e.height;return Math.floor(a)}function c(t,e,n){return{x:t,y:-e+n.height}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){const s=t.getContext("2d"),i=function(t,e){let n=e;const o=[];t=t.reverse();for(const e of t){const t=Object.assign({},e,{balanceAtPoint:n});n-=e.amount,o.push(t)}return o.reverse()}(e,n),{min:r,max:d}=function(t){let e=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const o of t)o.balanceAtPoint>n&&(n=o.balanceAtPoint),o.balanceAtPoint<e&&(e=o.balanceAtPoint);return{min:e,max:n}}(i);s.clearRect(0,0,t.width,t.height),s.beginPath();let l={};for(let e=0;e<i.length;e++){const n=a(i[e].balanceAtPoint,t,r,d),u=c(o(e,i.length,t),n,t);s.moveTo(l.x,l.y),s.lineTo(u.x,u.y),l=u}s.lineTo(t.width,t.height),s.strokeStyle="#fff",s.stroke()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const o=n(0);let a;function c(t,e,n){const o=document.createElement("img"),a=document.createElement("p");a.appendChild(o),o.setAttribute("src",t);const c=document.createElement("div");c.classList.add("monzo-transaction-logo"),c.appendChild(a);const s=document.createElement("p");s.innerText=e;const i=document.createElement("div");i.classList.add("monzo-transaction-description"),i.appendChild(s);const r=document.createElement("p");r.innerText=n;const d=document.createElement("div");d.classList.add("monzo-transaction-amount"),d.appendChild(r);const l=document.createElement("div");return l.classList.add("monzo-transaction"),l.appendChild(c),l.appendChild(i),l.appendChild(d),l}function s(t,e,n=!1){let o=e/Math.pow(10,t.decimalDigits);return n&&(o=Math.abs(o)),`${t.symbol}${o.toFixed(2)}`}Module.register("MMM-Monzo",{defaults:{},start(){this.sendSocketNotification("config",this.config)},getDom(){const t=document.createElement("div");return t.classList.add("monzo-wrapper"),t.appendChild(function(t){const e=document.createElement("h2");e.setAttribute("id","monzoBalance"),e.classList.add("monzo-amounts"),e.innerHTML=t;const n=document.createElement("span");n.classList.add("monzo-small"),n.innerHTML="Card Amount";const o=document.createElement("div");return o.classList.add("monzo-balance"),o.appendChild(e),o.appendChild(n),o}("")),t.appendChild(function(t){const e=document.createElement("h2");e.setAttribute("id","monzoSpentToday"),e.classList.add("monzo-amounts"),e.innerHTML=t;const n=document.createElement("span");n.classList.add("monzo-small"),n.innerHTML="Spent Today";const o=document.createElement("div");return o.classList.add("monzo-spent-today"),o.appendChild(e),o.appendChild(n),o}("")),t.appendChild(function(){const t=document.createElement("div");return t.setAttribute("id","monzoTransactions"),t.classList.add("monzo-transactions"),t}()),(a=document.createElement("canvas")).classList.add("monzo-canvas"),t.appendChild(a),t},getStyles(){return[this.file("styles/global.css")]},setBalance(t){document.getElementById("monzoBalance").innerText=t},setSpentToday(t){document.getElementById("monzoSpentToday").innerText=t},setTransactions(t,e){const n=document.getElementById("monzoTransactions");n.innerHTML="";const o=1/t.length;let a=1;for(const i of t){const t=`https://ui-avatars.com/api/?name=${i.description}&background=fff&color=000`,r=c(i.merchant&&i.merchant.logo?i.merchant.logo:t,i.merchant?i.merchant.name:i.description,s(e,i.amount,!0));r.setAttribute("style",`opacity: ${a}`),a-=o,n.appendChild(r)}},socketNotificationReceived(t,e){switch(Log.log(this.name+" received a notification: "+t),t){case"monzo-data":console.log(e);const n=e;this.setBalance(s(n.currency,n.balance.balance)),this.setSpentToday(s(n.currency,n.balance.spend_today,!0));const c=n.transactions.slice(Math.max(n.transactions.length-10,0)).reverse();this.setTransactions(c,n.currency),o.default(a,n.transactions,n.balance.balance)}}})}]);